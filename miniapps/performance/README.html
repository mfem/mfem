<!DOCTYPE html><html lang="en"><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../doc/web/favicon.ico">

<!--	<title>Performance - MFEM</title>  -->
    <title>MFEM - Finite Element Discretization Library</title>

        <link href="../../doc/web/bootstrap-mfem.min.css" rel="stylesheet">
        <link href="../../doc/web/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../doc/web/highlight.css">
        <link href="../../doc/web/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script async="" src="//www.google-analytics.com/analytics.js"></script><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-101697-3', 'mfem.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body style="">

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="http://mfem.org">MFEM</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
            
            
            
                <li>
                    <a href="http://mfem.org/features/">Features</a>
                </li>
            
            
            
            
            
                <li>
                    <a href="http://mfem.org/examples/">Examples</a>
                </li>
            
            
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/building/">Building MFEM</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/serial-tutorial/">Serial Tutorial</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/parallel-tutorial/">Parallel Tutorial</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/fem/">Finite Elements</a>
                            </li>
                        
                    
                        
                    
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/electromagnetics/">Electromagnetics</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/meshing/">Meshing</a>
                            </li>
                        
                    
                        
                    
                        
                            <li class="active">
                                 <a href="./">Performance</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/code-overview/">Code Overview</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/publications/">Publications</a>
                            </li>
                        
                    
                        
                            <li>
                                 <a href="http://mfem.org/about/">About</a>
                            </li>
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li>
                    <a href="http://mfem.org/gallery/">Gallery</a>
                </li>
            
            
            
            
            
                <li>
                    <a href="http://mfem.org/download/">Download</a>
                </li>
            
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li>
                    <a href="https://github.com/mfem/mfem">
                        
                            <i class="fa fa-github-square"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
            <div class="col-md-3 visible-xs visible-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tensor-based-operator-assembly-and-evaluation">Tensor-Based Operator Assembly and Evaluation</a></li>
        
            <li><a href="#overview">Overview</a></li>
        
            <li><a href="#template-implementation">Template implementation</a></li>
        
    
    </ul>
</div></div> <!-- toc on top on mobile -->
            <div class="col-md-9" role="main">

<h1 id="tensor-based-operator-assembly-and-evaluation">Tensor-Based Operator Assembly and Evaluation</h1>
<h2 id="overview">Overview</h2>
<p>The high performance (HPC) versions of the example codes in the <code>miniapps/performance</code> directory
use a set of templated classes to efficiently implement the inner-most portion
($B^T D B$) of the fundamental finite element (FE) operator decomposition:</p>
<p><img alt="" src="../../doc/web/FEDecomposition.png"></p>
<p>We take advantage of the tensor-product structure of both the finite element
basis and the quadrature rule to efficiently apply the action of $B$ without
necessarily computing its entries. This is generally know as <em><a href="http://www.sciencedirect.com/science/article/pii/0021999180900054">sum
factorization</a></em>.
In the case where we pre-compute and store the $D$ matrix, we call the algorithm
<em>partial assembly</em>.</p>
<h2 id="template-implementation">Template implementation</h2>
<p>Below is a short description of the header files that are part of the initial
reference implementation of the tensor-based finite element assembly and
evaluation algorithms.</p>
<h3 id="configtconfighpp">config/tconfig.hpp</h3>
<p>Configuration macros including the specification of the template blocking
   size (currently used in the matrix-matrix multiply).</p>
<h3 id="generaltassignhpp">general/tassign.hpp</h3>
<p>Helper templated function to allow single implementation of multiple
   assignment operations on tensor entries.</p>
<h3 id="linalgtlayouthpp">linalg/tlayout.hpp</h3>
<p>Classes describing fixed size tensor layouts. Implemented are standard
   strided layouts for 1D/2D/3D/4D tensors. Layouts support reshape and
   sub-tensor operations independent of the actual data storage.</p>
<p>This header also contains another set of "vector layout" classes for
   converting scalar data indices into multi-component (vector) data indices.
   They are used to describe the layout of vector <code>GridFunctions</code> on global
   degrees of freedom (similar to the <code>Ordering</code> class). In the FE operator
   decomposition, these classes are used by the templated <code>*_FiniteElementSpace</code>
   classes (see <code>fem/tfespace.hpp</code> below) to implement the actions of $G$ and
   $G^T$ in the case of vector (multi-component) input and/or output fields.</p>
<h3 id="linalgtmatrixhpp">linalg/tmatrix.hpp</h3>
<p>Small matrix operations, defined by specializations: determinant, adjugate,
   etc. Matrix-matrix multiply, <code>C = A.B</code>, simple and blocked version.</p>
<h3 id="linalgttensorhpp">linalg/ttensor.hpp</h3>
<p>Fixed-size container classes <code>TVector</code>, <code>TMatrix</code>, <code>TTensor3</code>, <code>TTensor4</code> for
   1D/2D/3D/4D tensors stored in column-major layout.
   Element-wise tensor operations: <code>A {=,+=,*=} scalar</code>; <code>A {=,+=,*=} B</code>.  The
   latter allows different input and output layouts. With suitable layouts this
   can be used to permute (transpose) tensors, extract sub-tensors, etc.
   The tensor contraction/product operations:</p>
<ul>
<li><code>Mult_1_2</code>: $C_{i,j,k} = \sum_s A_{s,j} B_{i,s,k}$</li>
<li><code>Mult_2_1</code>: $C_{i,j,k} = \sum_s A_{i,s} B_{s,j,k}$</li>
<li><code>TensorAssemble</code>: $C_{i,k,j,l} = \sum_s A_{s,i} A_{s,j} B_{k,s,l}~~$ and
     $~~D_{i,k,j,l} = \sum_s A_{i,s} B_{s,j} C_{k,s,l}$</li>
<li><code>TensorProduct</code>: $C_{i,j,k,l} = A_{i,j,k} B_{j,l}$</li>
</ul>
<h3 id="meshtmeshhpp">mesh/tmesh.hpp</h3>
<p>The Mesh object templated by the finite element space and layout of the
   nodes. Provides <code>MatchesGeometry()</code> and <code>MatchesNodes()</code> functions to verify
   if compiled and runtime mesh agree.</p>
<h3 id="femtintruleshpp">fem/tintrules.hpp</h3>
<p>Quadrature rules templated by geometry (triangles, quads, etc.) and
   integration order.</p>
<h3 id="femtfehpp">fem/tfe.hpp</h3>
<p>H1 and L2 finite elements templated by geometry and polynomial order.</p>
<h3 id="femtfespacehpp">fem/tfespace.hpp</h3>
<p>Template <code>*_FiniteElementSpace</code> classes providing the mappings between global
   and local (element) degrees of freedom for H1 continuous and L2 discontinuous
   spaces. In the FE operator decomposition, these classes provide the element
   local action of $G$ (<code>Extract</code> methods) and $G^T$ (<code>Assemble</code> methods).</p>
<h3 id="femtcoefficienthpp">fem/tcoefficient.hpp</h3>
<p>Templated versions of classes derived from the abstract class <code>Coefficient</code>.
   It encapsulates physical quantities like material properties, sources,
   boundary/initial conditions, etc. Its main functionality is to evaluate the
   coefficient at all quadrature points in an element, which is then used in the
   evaluation of the $D$ matrix.</p>
<h3 id="femteltranshpp">fem/teltrans.hpp</h3>
<p>Element transformation class, templated on a mesh type and an integration
   rule. It is constructed from a mesh (e.g. class <code>TMesh</code>) and shape evaluator
   (e.g. class <code>ShapeEvaluator</code>) objects. Allows computation of physical
   coordinates and Jacobian matrices corresponding to the reference integration
   points. The desired result (a combination of coordinates and/or Jacobian
   matrices at quadrature points, element attribute and/or element index) is
   specified through the template sub-class <code>Result</code> and stored in an object of
   the same type. The idea of this approach is to eliminate unnecessary
   evaluations if they are not needed. The need is determined based on what the
   particular "users" need. The "users" are the templated <code>Coefficient</code> and
   <code>Kernel</code> (see <code>fem/tbilininteg.hpp</code> below) classes which specify what they
   need through static constant boolean variables, e.g. <code>uses_coordinates</code>,
   <code>uses_Jacobians</code>, etc.</p>
<h3 id="femtevaluatorhpp">fem/tevaluator.hpp</h3>
<p>Classes for evaluating FE basis, <code>ShapeEvaluator</code>, and finite element
   functions, <code>FieldEvaluator</code>, and their derivatives at quadrature points,
   templated by a finite element class and an integration rule class. These
   correspond to the $B$ and $BG$ matrices above. Quads and hexes use the
   tensor-product structure for fast evaluation.</p>
<h3 id="femtbilininteghpp">fem/tbilininteg.hpp</h3>
<p><code>Kernel</code> classes (e.g. mass, diffusion) that represent the matrix $D$ from
   the above FE operator decomposition. These classes also specify the <em>type</em> of
   the local operator that needs to be applied before and after the $D$ matrix -
   these are the $B_{in}$ and $B^T_{out}$ matrices, respectively. The product
   $B^T_{out} D B_{in}$ is the local element matrix, which is the result when
   using the <code>BilinearFormIntegrator</code> classes. This specifications of the types
   are given by static constant boolean variables, e.g. <code>in_values</code> and
   <code>out_values</code>. The <code>Kernel</code> classes provide the following methods:</p>
<ul>
<li><code>Action</code>: evaluate the action of $D$ <em>without</em> explicitly storing the
     partially assembled data; this is needed for matrix-free action.</li>
<li><code>Assemble</code>: evaluate the partially assembled data, $D$, which is
     kernel-specific: e.g., for mass, the data is one scalar per quadrature
     point; for diffusion, the data is one $d\times d$ matrix (in $d$-dimensions)
     per quadrature point.</li>
<li><code>MultAssembled</code>: perform the action of $D$ using the pre-computed partially
     assembled data.</li>
</ul>
<h3 id="femtbilinearformhpp">fem/tbilinearform.hpp</h3>
<p>Bilinear form operator, templated on the mesh, finite element space,
   integration rule and bilinear form integrator. Corresponds to the $A$ matrix
   above. Provides various assembly and evaluation schemes:</p>
<ul>
<li><code>MultUnassembled</code>: matrix-free action using the mesh nodes and the input
     vector.</li>
<li><code>Assemble</code>, <code>MultAssembled</code>: partial assembly and operator action using the
     partially assembled data at quadrature points and the input vector.</li>
<li><code>AssembleMatrix(DenseTensor &amp;)</code>: assemble the local element matrices and
     store them as <code>DenseTensor</code>.</li>
<li><code>AssembleMatrix(SparseMatrix &amp;)</code>: assemble the operator in a global (CSR)
     <code>SparseMatrix</code>.</li>
<li><code>AssembleBilinearForm(BilinearForm &amp;)</code>: assemble element matrices and add
     them to the bilinear form.</li>
</ul>
<h3 id="miniappsperformancemakefile">miniapps/performance/makefile</h3>
<p>By default <code>make</code> builds the example drivers with the compiler used to
   compile MFEM. If <code>g++</code> was used, a pseudo-code dump file with the optimized
   code will be generated (option <code>-fdump-tree-optimized-blocks</code>). The <code>g++</code>
   option <code>--param max-completely-peel-times=3</code> prevents the compiler from
   unrolling innermost loops (of size greater than 3), allowing the compiler to
   vectorize them. Some options for optimization/vectorization with the clang
   compiler are also included.</p>
<h3 id="miniappsperformanceexcpp">miniapps/performance/ex*.cpp</h3>
<p>High-performance templated versions of the corresponding <code>examples/ex*.cpp</code>
   example codes.</p>
<script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: {equationNumbers: {autoNumber: "all"}}, tex2jax: {inlineMath: [['$','$']]}});</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG" id=""></script></div>
            <div class="col-md-3 hidden-xs hidden-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#tensor-based-operator-assembly-and-evaluation">Tensor-Based Operator Assembly and Evaluation</a></li>
        
            <li><a href="#overview">Overview</a></li>
        
            <li><a href="#template-implementation">Template implementation</a></li>
        
    
    </ul>
</div></div>

            
        </div>

        <footer class="footer">
           <div class="container">
              <p class="text-muted alignright">LLNL-WEB-676715</p>
              <p class="text-muted alignleft">
                  Developed by the <a href="/about/">MFEM team</a> at
                  <a href="http://computation.llnl.gov/casc/">CASC</a>,
                  <a href="https://www.llnl.gov/">LLNL</a></p>
           </div>
        </footer>

        <script src="../../doc/web/jquery-1.10.2.min.js"></script>
        <script src="../../doc/web/bootstrap-3.0.3.min.js"></script>
        <script src="../../doc/web/highlight.pack.js"></script>
        <script src="../../doc/web/base.js"></script>
        <script src="../../doc/web/retina.min.js"></script>
    

</body></html>
